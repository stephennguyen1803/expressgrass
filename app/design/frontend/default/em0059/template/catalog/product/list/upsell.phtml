<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php
    $pageLayout = str_replace(array('page/','.phtml'),'',Mage::app()->getLayout()->getBlock('root')->getTemplate());	
	$columnStandard = 3;
	
	if($pageLayout == '1column')
		$columnStandard = 4;
	
	else if($pageLayout == '3columns') 
		$columnStandard = 2;        
    
    $n = count($this->getProductCollection());
    
    $config = new EM_Em0059settings_Em0059settings();
    $w = $config->get_upsell_width();
    $h = $config->get_upsell_height();	
    $_helper = $this->helper('catalog/output');	
?>

<div class="box-collateral box-upsell">
    <h2 class="detail-title"><?php echo $this->__('You may also be interested in the following product(s)') ?></h2>
</div>
<?php if(!(count($this->getItemCollection()->getItems()))): ?>
    <p class="note-msg"><?php echo $this->__('There are no products matching the selection.') ?></p>
<?php else: ?>
<div id="slideshow-upsell" class="slideshow slideshow-upsell">	
	<div class="<?php if(count($this->getItemCollection()->getItems()) <= $columnStandard): ?>none-slider-upsell<?php else: ?>slideshow-box<?php endif ?>">   
	    <ul class="jcarousel-skin-tango">
	        <?php $i = 0; foreach ($this->getItemCollection()->getItems() as $_link) :?>                 
		        <li class="item<?php if(++$i == count($this->getItemCollection()->getItems())): ?> last<?php endif ;?>">
					<div class="product-item">
						<?php $_product = Mage::getModel('catalog/product')->load($_link->getId()); ?> 				
						<a href="<?php echo $_link->getProductUrl() ?>" title="<?php echo $this->htmlEscape($_link->getName()) ?>" class="product-image"><img src="<?php echo $this->helper('catalog/image')->init($_link, 'small_image')->resize($w, $h) ?>" width="<?php echo $w?>" height="<?php echo $h?>" alt="<?php echo $this->htmlEscape($_link->getName()) ?>" /></a>
						<h2 class="product-name"><a href="<?php echo $_link->getProductUrl() ?>" title="<?php echo $this->htmlEscape($_link->getName()) ?>"><?php echo $this->htmlEscape($_link->getName()) ?></a></h2>
						<?php echo $this->getReviewsSummaryHtml($_link) ?>                         
						<?php echo $this->getPriceHtml($_link, true, '-upsell') ?>               
						<a class="link-button" href="<?php echo $_link->getProductUrl() ?>" title="<?php echo $this->htmlEscape($_link->getName()) ?>"><span><?php echo $this->__('More Information') ?></span></a>
					</div>
				</li>
	        <?php endforeach; ?>
	    </ul>
	</div>
    
    <script type="text/javascript">
        jQuery(document).ready(function() {
            jQuery('#slideshow-upsell > div.slideshow-box > ul').jcarousel({
            wrap: 'circular',
        auto:0,
        buttonNextHTML:'<a class="next" href="javascript:void(0);" title="Next">Next</a>',
        buttonPrevHTML:'<a class="previous" href="javascript:void(0);" title="Previous">Pre</a>',
        scroll:1,
        animation:'slow'
            });
        });
    </script> 
</div>
<?php endif ?>
